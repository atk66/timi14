<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timi 14</title>
</head>
<body>
    <section>
        <h2>Æfing 1: Sækja notendur (users) og birta lista af nöfnum þeirra</h2>
        <ul id="user-list"></ul>
        <script>
            fetch("https://jsonplaceholder.typicode.com/users").then(response => 
               { if (!response.ok) {
                throw new Error("Network response was not ok")
               }
               return response.json()
                }
            ).then(users => {
                // Prenta í console til að sjá uppsetninguna á gögnum
                console.log("users", users)

                const userList = document.getElementById("user-list")
                users.forEach(user => {
                    const li = document.createElement("li")
                    li.textContent = user.name
                    userList.appendChild(li)
                })
            }).catch(error => {
                // Ef urlið er rangt þá mun response.ok ekki vera til og það mun fara í catch 
                // því við erum að fá throw error, það sem kemur inn í throw error birtist í console í inspect
                console.error("VILLA", error)
            })
        </script>
    </section>
    <section>
        <h2>Æfing 2: Sækja notendur með async/await og birta lista af símanúmerum</h2>
        <ul id="user-list-async"></ul>
        <script>
            async function getUsersAsync() {
                const response = await fetch("https://jsonplaceholder.typicode.com/users")
                const users = await response.json()
                console.log("Users in async", users)

                const usersList = document.getElementById("user-list-async")
                users.forEach(user => {
                    const li = document.createElement("li")
                    li.textContent = user.phone
                    usersList.appendChild(li)
                })
                
            }
            getUsersAsync()
        </script>
    </section>
    <section>
        <h2>Æfing 3: Skrifa rangt URL til að prófa villumeðhöndlun </h2>
        <p id="status-invalid-url"></p>
        <script>
            async function testInvalidUrl() {
                const statusInvalidUrl =document.getElementById("status-invalid-url")
                try {
                    const response = await fetch("https://jsonplaceholder.typicode.com/invalid-url")
                    if (!response.ok) {
                        throw new Error(`HTTP villa: ${response.status}`)
                    }
                    // Ef við tökum if út þá mun línan fyrir neðan birtist því við erum ekki að kasta villu
                    statusInvalidUrl.textContent = "Gögnin hlaðin án villu (átti ekki að gerast)"
                    retun response.json()

                }
                catch (error) {
                    statusInvalidUrl.textContent = "Villa við að hlaða gögnum"
                    console.error("Villa kom upp:", error)
                }

            }
            testInvalidUrl()
        </script>
    </section>
    <section>
        <h2>Æfing 4: Bæta við "Hleð gögn..." skilabð</h2>
        <ul id="user-list-loading"></ul>
        <p id="loading"></p>

        <script>
            function getUsersWithStatus() {
                const usersListLoading = document.getElementById("user-list-loading");
                const loadingText = document.getElementById("loading");

                loadingText.textContent = "Hleð gögnum...";
                setTimmeout(() => {
                    fetch("https://jsonplaceholder.typicode.com/users").then(
                        response => response.json()).then(
                            users => {users.forEach(user => {
                                const li = document.createElement("li");
                                li.textContent = user.company.name
                                usersListLoading.appendChild(li);

                            })
                            loadingText.textContent = "";
                            }).catch(error => {
                                console.error("Villa: ", error);
                                loadingText.textContent = "Villa kom upp!";
                            });


                }, 2000 );
            }
            getUsersWithStatus();
        </script>
    </section>
    <section>
        <h2>Æfing 5: Búa til okkar eigin Promise og nota setTimeout</h2>
        <input id="sek" type="number" placeholder="Fjöldi sekúnda"/>
        <button id="takki" onclick="runFunction()">Byrja</button>

        <script>
            function wait(seconds) {
                return new Promise ((resolve) => {
                    setTimeout(() => resolve("Tíminn er liðinn! þetta er responsið úr promise"), seconds * 1000)
                })
            }

            async function runFunction () {
                const sek = document.getElementById("sek").value
                console.log(`Bíð í ${sek} sekundur`)
                const skilaboð = await wait(sek)
                console.log(skilaboð);
            }
        </script>
    </section>
</body>
</html>